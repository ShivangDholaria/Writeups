# JAuth

## Overview

Points: 300

Category: Web Exploitataion

## Description
Most web application developers use third party components without testing their security. Some of the past affected companies are:
- Equifax (a US credit bureau organization) - breach due to unpatched Apache Struts web framework CVE-2017-5638
- Mossack Fonesca (Panama Papers law firm) breach - unpatched version of Drupal CMS used
- VerticalScope (internet media company) - outdated version of vBulletin forum software used

Can you identify the components and exploit the vulnerable one?
The website is running `here`. Can you become an `admin`?
You can login as `test` with the password `Test123!` to get started.

## Hints (if any)
1. Use the web browser tools to check out the JWT cookie.
2. The JWT should always have two (2) `.` separators.
## Approach

We need to become admin from test user. Kind of challenging... but possible. Lets first see what the webapp looks like.

![homepage](./img/jauth%202.png)

Pretty simple, just the user login page. Lets login as the test user and see what we have here:

![test user](./img/jauth%203.png)

Lets open up the dev tools and see if any cookies are used?

![webapp cookie](./img/jauth%204.png)

We see that a cookie called `token` with the value `eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdXRoIjoxNzE4ODI4MzEyMTBZkWWuUHNahSjQZtmeoQYjMvmHe1WYuCTXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTBZkWWuUHNahSjQZtmeoQYjMvmHe1WYuCTYuMC4wLjAgU2FmYXJpLzUzNy4zNiBFZGcvMTBZkWWuUHNahSjQZtmeoQYjMvmHe1WYuCTpYXQiOjE3MTg4MjgzMTJ9.IXlqq5yWcqQPH6H-YGLcS3x9rD5_F3PO6j2Xif3arEU`. This looks like a [JWT token](https://jwt.io/). From the value, we can see that the token is serialized, so lets deserialize it and see the contents of this token:

![deserialized token](./img/jauth%205.png)

The header specifies the type of algorith used hash the secret(if any) is sent and the payload contains the info rmation about this user. Since we need to become `admin` user, lets try change the `role` key to value and update the value of the token:

![updated JWt](./img/jauth%208.png)

But when we update the value and refresh the page, we see an authentication error.

![Authentication fail](./img/jauth%207.png)

What went wrong here. I saw that the `alg` key in header uses alogrithm `HS256`. As we only changed the `role` value, only the payload got changed but not the signature. This caused the authentication error to occur.

![Updated token](./img/jauth%208.png)

To prevent this, I found out that we can exclude the algorithm from being hashed but setting the value of `alg` to `none`. On doing so, we see that signature field is removed and we are only left with header and payload section. But a JWT token need to have 3 field seperated by 2 `.`. So we add a `.` at the end of the newly made JWT string and then update the token.

![final jwt token string](./img/jauth%209.png)

We now see the flag!

![admin login](./img/jauth%2010.png)
## Flag
picoCTF{succ3ss_@u7h3nt1c@710n_3444eacf}